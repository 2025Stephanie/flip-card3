<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ç¿»ç‰ŒéŠæˆ²</title>
  <!-- å¼•å…¥ LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      height: 100%; width: 100%; font-family: "Microsoft JhengHei", sans-serif;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      background-color: #f4f4f4; text-align: center;
    }
    h1 { margin-bottom: 10px; }
    p { margin-bottom: 10px; }
    #countdown { font-size: 20px; margin-bottom: 30px; color: #d35400; }
    .card-container { display: flex; justify-content: center; gap: 20px; width: 100%; padding: 0 10px; }
    .card { flex: 1; max-width: 300px; height: 60vh; perspective: 1000px; cursor: pointer; }
    .card-inner { width: 100%; height: 100%; position: relative; transition: transform 0.6s; transform-style: preserve-3d; }
    .card.flipped .card-inner { transform: rotateY(180deg); }
    .card-front, .card-back {
      position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
      border: 1px solid #ccc; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px;
    }
    .card-front { background: #2c3e50; color: white; }
    .card-back { background: #a3d5ff; color: #333; transform: rotateY(180deg); }
    #loading { font-size: 24px; }
  </style>
</head>
<body>
  <!-- åˆå§‹è¼‰å…¥ç•«é¢ -->
  <div id="loading">éŠæˆ²è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™...</div>
  
  <!-- éŠæˆ²ä¸»ç•«é¢ (é è¨­éš±è—) -->
  <div id="game-content" style="display:none;">
    <h1>ğŸ´ ç¿»ç‰ŒæŠ½ç¦®éŠæˆ²</h1>
    <p>é»æ“Šä»»ä¸€å¼µå¡ç‰‡æŸ¥çœ‹ä½ ç²å¾—çš„æ˜¯å“ªä¸€ç¦®ï¼</p>
    <div id="countdown">è«‹åœ¨ <span id="time">30</span> ç§’å…§ç¿»ç‰Œï¼</div>

    <div class="card-container">
      <div class="card" onclick="flipCard(this, 'ğŸ å¹¸é‹ç¦®')">
        <div class="card-inner">
          <div class="card-front">é»æˆ‘</div>
          <div class="card-back">ğŸ å¹¸é‹ç¦®</div>
        </div>
      </div>
      <div class="card" onclick="flipCard(this, 'ğŸ’° ç™¼è²¡ç¦®')">
        <div class="card-inner">
          <div class="card-front">é»æˆ‘</div>
          <div class="card-back">ğŸ’° ç™¼è²¡ç¦®</div>
        </div>
      </div>
      <div class="card" onclick="flipCard(this, 'ğŸ•Šï¸ ç¦æ°£ç¦®')">
        <div class="card-inner">
          <div class="card-front">é»æˆ‘</div>
          <div class="card-back">ğŸ•Šï¸ ç¦æ°£ç¦®</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Google è¡¨å–®ï¼Œå¢åŠ å¤šå€‹æ¬„ä½ -->
  <form id="resultForm" action="https://docs.google.com/forms/d/e/1FAIpQLSe9s1I_xUjQY3LNeA1dX1yFExn5juBwzy48700vYsYPgRKCgg/formResponse" method="POST" target="hidden_iframe" style="display:none">
    <input name="entry.1143804336" id="userIdInput">      <!-- å°æ‡‰ LINE UserID -->
    <input name="entry.1988734299" id="nameInput">        <!-- å°æ‡‰ LINE æš±ç¨± -->
    <input name="entry.204610394" id="prizeInput">       <!-- å°æ‡‰ æŠ½ä¸­çé … -->
    <input name="entry.1457523528" id="timeInput">        <!-- å°æ‡‰ å®Œæˆæ™‚é–“ -->
  </form>
  <!-- å¢åŠ ä¸€å€‹éš±è—çš„ iframe ä¾†è™•ç†è¡¨å–®æäº¤ï¼Œé¿å…é é¢è·³è½‰ -->
  <iframe name="hidden_iframe" style="display:none;"></iframe>


  <script>
    // --- å…¨åŸŸè®Šæ•¸ ---
    let hasFlipped = false;
    let countdown = 30;
    let lineUserId = '';      // ç”¨ä¾†å„²å­˜ LINE User ID
    let lineDisplayName = ''; // ç”¨ä¾†å„²å­˜ LINE é¡¯ç¤ºåç¨±
    let interval;

    const timerDisplay = document.getElementById('time');
    // const flipSound = document.getElementById('flipSound'); // <-- å·²ç§»é™¤
    const loadingDiv = document.getElementById('loading');
    const gameContentDiv = document.getElementById('game-content');

    // --- LIFF åˆå§‹åŒ–èˆ‡ä¸»ç¨‹å¼ ---
    async function main() {
      try {
        // åœ¨é€™è£¡æ›æˆä½ çš„ LIFF ID
        await liff.init({ liffId: "2007611369-ZJ9eE5xl" }); 
        
        if (!liff.isLoggedIn()) {
          // å¦‚æœç”¨æˆ¶æ²’ç™»å…¥ï¼Œå¼•å°ä»–å€‘ç™»å…¥
          loadingDiv.textContent = "è«‹å…ˆç™»å…¥ LINE æ‰èƒ½é–‹å§‹éŠæˆ²";
          liff.login();
        } else {
          // ç²å–ç”¨æˆ¶è³‡æ–™
          const profile = await liff.getProfile();
          lineUserId = profile.userId;
          lineDisplayName = profile.displayName;
          
          // é¡¯ç¤ºéŠæˆ²ç•«é¢ï¼Œé–‹å§‹å€’æ•¸
          loadingDiv.style.display = 'none';
          gameContentDiv.style.display = 'flex';
          gameContentDiv.style.flexDirection = 'column';
          gameContentDiv.style.alignItems = 'center';
          startTimer();
        }
      } catch (error) {
        console.error(error);
        loadingDiv.textContent = "LIFF åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹åœ¨ LINE App ä¸­é–‹å•Ÿæ­¤é é¢ã€‚";
      }
    }

    // å•Ÿå‹• LIFF
    main();

    // --- éŠæˆ²é‚è¼¯ ---
    function startTimer() {
      interval = setInterval(() => {
        countdown--;
        timerDisplay.textContent = countdown;
        if (countdown <= 0) {
          clearInterval(interval);
          document.querySelectorAll('.card').forEach(c => c.onclick = null);
          document.getElementById('countdown').innerHTML = 'æ™‚é–“åˆ°ï¼<br>è«‹é—œé–‰é é¢å¾Œå†è©¦ä¸€æ¬¡ã€‚';
        }
      }, 1000);
    }

    function flipCard(card, prize) {
      if (hasFlipped) return;

      hasFlipped = true;
      clearInterval(interval); // åœæ­¢è¨ˆæ™‚
      
      card.classList.add('flipped');
      // flipSound.play(); // <-- å·²ç§»é™¤
      
      // é–å®šå…¶é¤˜å¡ç‰‡ä¸¦é¡¯ç¤ºçµæœ
      document.querySelectorAll('.card').forEach(c => {
          c.onclick = null; 
          c.style.cursor = 'default';
      });
      document.getElementById('countdown').innerHTML = `æ­å–œæ‚¨æŠ½ä¸­ã€${prize}ã€‘ï¼<br>çå‹µå°‡ç™¼é€è‡³æ‚¨çš„å¸³è™Ÿã€‚`;


      // è¨ˆç®—å®Œæˆæ™‚é–“
      const timeTaken = 30 - countdown;

      // æº–å‚™ä¸¦é€å‡ºè¡¨å–®
      document.getElementById('userIdInput').value = lineUserId;
      document.getElementById('nameInput').value = lineDisplayName;
      document.getElementById('prizeInput').value = prize;
      document.getElementById('timeInput').value = timeTaken;
      
      console.log("æº–å‚™æäº¤è¡¨å–®..."); // å¢åŠ ä¸€å€‹æ—¥èªŒï¼Œæ–¹ä¾¿é™¤éŒ¯
      document.getElementById('resultForm').submit();
      console.log("è¡¨å–®å·²æäº¤ï¼"); // å¢åŠ ä¸€å€‹æ—¥èªŒï¼Œæ–¹ä¾¿é™¤éŒ¯

      // (å¯é¸) 2ç§’å¾Œè‡ªå‹•é—œé–‰è¦–çª—
      setTimeout(() => {
        if (liff.isInClient()) {
          liff.closeWindow();
        }
      }, 2000);
    }
  </script>

</body>
</html>
